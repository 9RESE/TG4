# ============================================================================
# Agent Configuration
# ============================================================================
# Configuration for all LLM agents in the TripleGain system.

# ============================================================================
# LLM Provider Configuration
# ============================================================================
providers:
  ollama:
    base_url: "http://localhost:11434"
    timeout_seconds: 30
    default_model: "qwen2.5:7b"
    default_options:
      temperature: 0.3
      top_p: 0.9
      top_k: 40
      num_predict: 1024
      num_ctx: 8192
      repeat_penalty: 1.1

  openai:
    # API key from OPENAI_API_KEY env var
    base_url: "https://api.openai.com/v1"
    timeout_seconds: 60
    default_model: "gpt-4-turbo"

  anthropic:
    # API key from ANTHROPIC_API_KEY env var
    base_url: "https://api.anthropic.com/v1"
    api_version: "2023-06-01"
    timeout_seconds: 60
    default_model: "claude-3-5-sonnet-20241022"

  deepseek:
    # API key from DEEPSEEK_API_KEY env var
    base_url: "https://api.deepseek.com/v1"
    timeout_seconds: 60
    default_model: "deepseek-chat"

  xai:
    # API key from XAI_BEARER_API_KEY env var
    base_url: "https://api.x.ai/v1"
    timeout_seconds: 60
    default_model: "grok-2-1212"

# ============================================================================
# Agent Definitions
# ============================================================================
agents:
  # --------------------------------------------------------------------------
  # Technical Analysis Agent
  # --------------------------------------------------------------------------
  technical_analysis:
    enabled: true
    tier: tier1_local
    provider: ollama
    model: "qwen2.5:7b"
    invocation:
      frequency: per_minute
      on_candle_close: true
    timeout_ms: 5000
    retry_count: 2
    template: "technical_analysis.txt"
    latency_target_ms: 500

  # --------------------------------------------------------------------------
  # Regime Detection Agent
  # --------------------------------------------------------------------------
  regime_detection:
    enabled: true
    tier: tier1_local
    provider: ollama
    model: "qwen2.5:7b"
    invocation:
      frequency: every_5_minutes
      on_significant_change: true
    timeout_ms: 5000
    retry_count: 2
    template: "regime_detection.txt"
    latency_target_ms: 500

  # --------------------------------------------------------------------------
  # Sentiment Analysis Agent (Phase 7)
  # --------------------------------------------------------------------------
  # Dual-model sentiment using Grok (xAI) for social/Twitter and GPT (OpenAI)
  # for fundamental/news analysis.
  #
  # NOTE: Grok has X/Twitter search capability. Standard GPT-4 models do NOT
  # have web search - they use training data. For real-time news, consider
  # integrating an external news API (CryptoPanic, NewsAPI) in future phases.
  # OpenAI's gpt-4o-search-preview model supports web search but costs more.
  sentiment_analysis:
    enabled: true
    tier: tier2_api

    invocation:
      trigger: scheduled
      interval_seconds: 1800  # 30 minutes
      symbols:
        - BTC/USDT
        - XRP/USDT

    providers:
      grok:
        enabled: true
        model: grok-2
        timeout_ms: 30000
        capabilities:
          - web_search
          - twitter_search
        weight:
          social: 0.6  # Grok excels at social/Twitter sentiment
          news: 0.4
        retry:
          max_attempts: 2
          backoff_ms: 5000

      gpt:
        enabled: true
        model: gpt-4-turbo  # Uses training data, not real-time search
        timeout_ms: 30000
        capabilities: []  # No real-time web search capability
        weight:
          social: 0.4
          news: 0.6  # GPT excels at fundamental analysis
        retry:
          max_attempts: 2
          backoff_ms: 5000

    aggregation:
      min_providers: 1  # At least one must succeed
      min_confidence: 0.3

    output:
      store_all: true
      cache_ttl_seconds: 1750  # Just under 30 min
      max_events: 5
      max_narratives: 3

    # Circuit breaker for provider failures
    circuit_breaker:
      failure_threshold: 3  # Open after 3 consecutive failures
      cooldown_seconds: 300  # Wait 5 minutes before retrying

    # Rate limiting for API endpoints
    rate_limit:
      refresh_rpm: 5  # 5 refresh requests per minute per user

    # Integration with other agents
    integration:
      publish_topic: sentiment_updates
      ttl_seconds: 1800

  # --------------------------------------------------------------------------
  # Trading Decision Agent
  # --------------------------------------------------------------------------
  trading_decision:
    enabled: true
    tier: multi_model
    invocation:
      frequency: hourly
      on_signal: true
    timeout_seconds: 30
    models:
      qwen:
        provider: ollama
        model: "qwen2.5:7b"
      gpt4:
        provider: openai
        model: "gpt-4-turbo"
      grok:
        provider: xai
        model: "grok-2-1212"
      deepseek:
        provider: deepseek
        model: "deepseek-chat"
      sonnet:
        provider: anthropic
        model: "claude-3-5-sonnet-20241022"
      opus:
        provider: anthropic
        model: "claude-3-opus-20240229"
    consensus:
      min_agreement: 0.50  # 50% must agree
      high_agreement: 0.67  # 2/3 for high confidence
      fallback_on_tie: "HOLD"
    template: "trading_decision.txt"

  # --------------------------------------------------------------------------
  # Coordinator Agent (Phase 3)
  # --------------------------------------------------------------------------
  coordinator:
    enabled: true  # Phase 3 complete
    tier: tier2_api
    provider: deepseek
    model: "deepseek-chat"
    fallback_provider: anthropic
    fallback_model: "claude-3-5-sonnet-20241022"
    invocation:
      on_conflict: true
    template: "coordinator.txt"

  # --------------------------------------------------------------------------
  # Portfolio Rebalance Agent
  # --------------------------------------------------------------------------
  portfolio_rebalance:
    enabled: true
    tier: tier2_api
    provider: deepseek
    model: "deepseek-chat"
    invocation:
      frequency: hourly
      on_deviation: true
    timeout_seconds: 30
    template: "portfolio_rebalance.txt"

# ============================================================================
# Token Budget Configuration
# ============================================================================
token_budgets:
  tier1_local:
    total: 8192
    input: 6000
    output: 2000
    buffer: 500

  tier2_api:
    total: 16384
    input: 12000
    output: 4000
    buffer: 1000

  multi_model:
    total: 8192  # Per model
    input: 6000
    output: 2000
    buffer: 500

# ============================================================================
# Cost Budget Configuration
# ============================================================================
cost_budget:
  daily_limit_usd: 5.00
  warn_threshold_usd: 4.00
  per_decision_limit_usd: 0.50
  model_cost_tracking: true

# ============================================================================
# Performance Targets
# ============================================================================
performance:
  tier1_latency_ms: 500
  tier2_latency_ms: 3000
  decision_latency_ms: 10000

# ============================================================================
# Output Storage
# ============================================================================
storage:
  store_all_outputs: true
  store_model_comparisons: true
  retention_days: 90
  compression_after_days: 7

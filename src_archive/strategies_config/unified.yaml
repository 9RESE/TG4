# Unified Strategy Configuration
# Phase 24: Combined configuration for all strategies
#
# To enable a strategy, set enabled: true
# To experiment with parameters, modify values and re-run

global:
  # Default settings applied to all strategies
  paper_trading: true
  starting_balance:
    USDT: 2000.0
    XRP: 0.0
    BTC: 0.0
  fee_rate: 0.001  # 0.1%
  max_drawdown: 0.10  # 10%

  # Risk management
  risk_per_trade: 0.10  # 10% of capital per trade
  max_concurrent_positions: 5

strategies:
  # ===== GENERAL STRATEGIES =====

  defensive_yield:
    enabled: false  # Requires stable_baselines3 RL library - disable for now
    category: general
    description: "RL-driven defensive strategy with yield accrual"
    max_leverage: 10
    modes:
      defensive_atr: 0.04  # ATR > 4% triggers defensive
      offensive_atr: 0.02  # ATR < 2% triggers offensive
    yield:
      usdt_apy: 0.065  # 6.5% APY

  mean_reversion_vwap:
    enabled: true
    category: general
    description: "VWAP + RSI mean reversion for choppy markets"
    symbol: "XRP/USDT"
    # Tunable parameters - RELAXED based on 12/12 run analysis
    dev_threshold: 0.002      # VWAP deviation (was 0.003 - too strict)
    rsi_oversold: 40          # RSI oversold (was 35 - RSI was at 41!)
    rsi_overbought: 60        # RSI overbought (was 65)
    volume_mult: 1.0          # Volume filter DISABLED (was 1.3 - blocked all signals)
    max_leverage: 5
    stop_loss_pct: 0.04

  xrp_btc_pair_trading:
    enabled: true
    category: general
    description: "XRP/BTC cointegration stat arb (Phase 25: strict cointegration + half-life)"
    xrp_symbol: "XRP/USDT"
    btc_symbol: "BTC/USDT"

    # Phase 25: Separate lookback windows (avoids look-ahead bias)
    hedge_lookback: 168       # 1 week for hedge ratio estimation
    zscore_lookback: 72       # 3 days for z-score calculation

    # Entry/exit thresholds
    entry_z: 2.0              # Z-score entry (stricter - requires real edge)
    exit_z: 0.5               # Z-score exit (mean reverted)
    stop_z: 3.5               # Z-score stop loss (wider for pair trades)

    # Phase 25: Strict cointegration enforcement
    coint_pvalue_threshold: 0.05   # 5% significance (strict)
    spread_adf_threshold: 0.10     # ADF test on spread
    require_cointegration: true    # Block trades without cointegration

    # Phase 25: Half-life filtering
    use_half_life_filter: true
    max_half_life: 48         # Max 48 hours (trade must revert reasonably fast)
    min_half_life: 2          # Min 2 hours (avoid noise trades)

    # Phase 25: Faster hedge updates
    hedge_recalc_period: 6    # Recalculate every 6 hours (was 24)

    # Phase 25: Regime-based dynamic thresholds
    use_regime_adjustment: true    # Adjust entry_z based on volatility

    # Transaction costs
    fee_rate: 0.001           # 0.1% per leg
    min_expected_profit: 0.01 # Require 1% expected profit after fees

    # BTC filter (disabled by default - let cointegration handle it)
    use_btc_filter: false

    max_leverage: 5           # Conservative leverage (was 10)

  ma_trend_follow:
    enabled: true
    category: general
    description: "Phase 26: EMA trend following with ADX filter, ATR stops, ribbon confirmation"

    # MA Settings
    ma_type: ema                    # 'ema' (default) or 'sma' - EMA is more responsive
    ma_period: 12                   # Increased from 9 for less noise
    confirmation_candles: 2         # Increased from 1 - require 2 closes for trend
    min_distance_pct: 0.003         # 0.3% min distance from MA (avoid whipsaw zone)
    exit_opposite: true             # Exit on trend reversal

    # Symbols to trade
    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

    # ADX Filter (trend strength) - KEY IMPROVEMENT
    use_adx_filter: true            # Enable ADX filtering
    adx_period: 14                  # ADX calculation period
    min_adx: 20                     # Only trade when ADX > 20 (trending)
    strong_adx: 30                  # ADX > 30 = strong trend (confidence boost)

    # ATR Stop Loss - CRITICAL FOR RISK MANAGEMENT
    use_atr_stop: true              # Enable ATR-based stops
    atr_period: 14                  # ATR calculation period
    atr_stop_mult: 2.0              # Stop at 2x ATR from entry

    # Volume Filter
    use_volume_filter: true         # Enable volume confirmation
    volume_window: 20               # Volume average window
    volume_mult: 1.3                # Require 1.3x avg volume

    # Breakout Detection
    breakout_vol_mult: 2.0          # 2x volume = breakout (was 1.5)
    high_lookback: 24               # 24-hour high breakout window

    # RSI Filter
    use_rsi_filter: true            # Enable RSI filtering
    rsi_period: 14                  # RSI calculation period
    rsi_overbought: 70              # Don't buy above 70
    rsi_oversold: 30                # Don't short below 30

    # MA Ribbon (multi-MA trend confirmation)
    use_ribbon: true                # Enable ribbon analysis
    ribbon_periods:                 # MA periods for ribbon
      - 5
      - 10
      - 20
      - 30
      - 50

    # Cooldown (prevent overtrading)
    cooldown_hours: 4               # Min hours between trades per symbol

    # Position Sizing
    position_size_pct: 0.10         # 10% of portfolio per trade
    max_leverage: 5                 # Max 5x leverage

  xrp_btc_leadlag:
    enabled: true
    category: general
    description: "XRP/BTC correlation lead-lag trading"
    high_corr_threshold: 0.8
    low_corr_threshold: 0.6
    breakout_leverage: 7
    min_btc_move: 0.005

  mean_reversion_short:
    enabled: true
    category: general
    description: "VWAP/RSI short-focused mean reversion"
    symbol: "XRP/USDT"
    vwap_period: 20
    deviation_threshold: 0.02    # 2% above/below VWAP
    band_std_mult: 2.0
    rsi_period: 14
    rsi_overbought: 65           # Short when RSI > 65 + above VWAP
    rsi_oversold: 35             # Long when RSI < 35 + below VWAP
    max_leverage: 5

  # ===== LSTM STRATEGIES =====

  xrp_momentum_lstm:
    enabled: true
    category: lstm
    description: "Phase 25: LSTM momentum with priority-based signals, BTC correlation, and position management"
    symbol: "XRP/USDT"
    btc_symbol: "BTC/USDT"

    # Core indicator periods
    atr_period: 14
    momentum_period: 10
    rsi_period: 14

    # Dip detection (lowered for more activity)
    dip_lookback: 24             # Hours to look back for dips
    dip_threshold: -0.02         # 2% dip threshold (was -3%)

    # Volume thresholds (lowered for more signals)
    volume_spike_mult: 1.5       # 1.5x average volume = spike (was 2.0)
    volume_lookback: 50

    # Momentum thresholds (tuned for XRP volatility)
    momentum_buy_threshold: 0.03      # 3% momentum for buy (was 5%)
    momentum_sell_threshold: -0.03    # -3% momentum for sell (was -5%)
    momentum_recovery_threshold: -0.015  # Dip recovery threshold (was -2%)

    # RSI filter
    use_rsi_filter: true
    rsi_oversold: 35
    rsi_overbought: 65

    # BTC correlation (leading indicator)
    use_btc_correlation: true
    btc_lead_threshold: 0.02     # 2% BTC move = leading signal

    # Multi-timeframe confirmation
    use_multi_timeframe: true
    mtf_agreement_required: false  # Set true for stricter entries

    # Position management
    stop_loss_pct: 0.03          # 3% stop loss
    take_profit_pct: 0.05        # 5% take profit
    trailing_stop: false         # Enable trailing stop
    trailing_stop_pct: 0.02      # 2% trailing stop

    # LSTM integration
    use_lstm: true               # ENABLED - uses pre-trained model!
    model_path: "models/lstm_xrp.pth"
    lstm_seq_len: 60

    # Leverage
    max_leverage: 10
    position_size_pct: 0.10

  dip_detector:
    enabled: true
    category: general  # Rule-based strategy (not LSTM)
    description: "Phase 26: Enhanced dip detector with RSI divergence, BTC filter, MTF confirmation"

    # Multi-asset support
    symbols:
      - "XRP/USDT"
      - "BTC/USDT"
    btc_symbol: "BTC/USDT"

    # RSI parameters (relaxed for crypto volatility)
    rsi_period: 14
    rsi_oversold: 38             # Relaxed from 30 - more realistic for crypto
    rsi_overbought: 65           # Relaxed from 70
    rsi_extreme_oversold: 25     # Strong signal threshold

    # RSI Divergence detection (HIGH VALUE SIGNAL)
    use_divergence: true
    divergence_lookback: 14
    divergence_min_bars: 3

    # Volume parameters
    volume_lookback: 20
    volume_surge_threshold: 1.5      # 1.5x average = surge
    volume_capitulation_threshold: 2.5  # 2.5x = capitulation (strong signal)

    # Drawdown parameters
    drawdown_lookback: 20
    drawdown_threshold: -0.05    # 5% dip
    drawdown_strong: -0.08       # 8% = strong dip

    # ATR volatility context
    atr_period: 14
    max_atr_for_leverage: 0.08   # Max 8% ATR for leverage approval
    min_atr_for_trade: 0.005     # Min 0.5% volatility to trade

    # BTC Correlation Filter (XRP follows BTC)
    use_btc_filter: true
    btc_stable_threshold: 0.02   # 2% BTC move threshold
    btc_correlation_period: 24   # Hours to look back

    # Multi-timeframe confirmation
    use_mtf: true
    mtf_rsi_threshold: 45        # Higher TF RSI must be < 45

    # Position tracking and cooldown
    cooldown_minutes: 30         # Min time between signals
    max_positions: 2             # Max concurrent positions

    # Risk management (2:1 reward-to-risk)
    stop_loss_pct: 0.03          # 3% stop loss
    take_profit_pct: 0.06        # 6% take profit
    use_trailing_stop: false     # Enable for trending markets
    trailing_stop_pct: 0.02      # 2% trailing stop

    # Position sizing and leverage
    position_size_pct: 0.10      # 10% of portfolio
    max_leverage: 10

  # ===== UTILITY STRATEGIES =====

  portfolio_rebalancer:
    enabled: false               # Enable for portfolio management
    category: utility
    description: "Maintains target asset allocations"
    target_weights:
      BTC: 0.40
      XRP: 0.30
      USDT: 0.30
    deviation_threshold: 0.05    # 5% deviation triggers rebalance
    min_trade_usd: 50.0
    rebalance_cooldown: 60       # Minutes between rebalances

  # ===== SCALPER STRATEGIES =====
  # Phase 30: Optimized for 1-minute candles with 60s polling

  intraday_scalper:
    enabled: true
    category: scalper
    description: "Phase 30: BB squeeze + RSI scalper optimized for 1m candles"

    # Symbols
    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

    # Indicator periods - LONGER for 1m data (reduce noise)
    bb_period: 20             # Was 12 - 20 min of data smooths noise
    bb_std: 2.0               # Standard 2 std dev bands
    rsi_period: 14            # Was 7 - 14 min RSI is less noisy
    ema_period: 21            # Was 9 - 21 min EMA for trend filter
    adx_period: 14            # Standard ADX period
    atr_period: 14            # Standard ATR period

    # RSI thresholds - TIGHTER for 1m (require more extreme readings)
    rsi_oversold: 25          # Was 30 - require deeper oversold
    rsi_overbought: 75        # Was 70 - require stronger overbought

    # Volatility thresholds - LOWER for 1m (1m ATR is smaller %)
    vol_threshold: 0.15       # 0.15% 1m ATR to activate (not 0.7% daily)
    vol_threshold_high: 1.0   # 1% 1m ATR = too volatile

    # ADX filter - trade ranging markets for mean reversion
    use_adx_filter: true
    adx_max: 25               # Only trade when ADX < 25 (ranging)

    # Volume filter - STRICTER for 1m
    use_volume_filter: true
    volume_mult: 1.5          # Was 1.3 - require 1.5x avg volume
    volume_window: 20         # 20-bar volume average

    # Squeeze detection
    squeeze_threshold: 0.8    # Band width < 80% of avg = squeeze
    require_squeeze: false    # Don't require squeeze (optional)

    # Risk management
    max_leverage: 3
    stop_loss_pct: 0.003      # 0.3% tight stop for 1m scalps
    take_profit_pct: 0.006    # 0.6% target (2:1 R:R)
    scalp_target_pct: 0.006   # Same as take_profit
    scalp_stop_pct: 0.003     # Same as stop_loss

    # Position sizing - SMALLER for more frequent trades
    base_size_pct: 0.05       # 5% base position (was 8%)
    dynamic_sizing: true      # Adjust size based on volatility
    min_size_pct: 0.02        # Min 2% position
    max_size_pct: 0.10        # Max 10% position

    # Cooldown - SHORTER for 1m
    cooldown_bars: 5          # 5 bars = 5 min cooldown
    cooldown_minutes: 5       # 5 min minimum between trades

  ema9_scalper:
    enabled: true
    category: scalper
    description: "Phase 30: EMA crossover scalper optimized for 1m candles"

    # Symbols
    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

    # EMA periods - LONGER for 1m data
    ema_fast_period: 9        # 9-min fast EMA
    ema_slow_period: 21       # 21-min slow EMA (classic 9/21 crossover)
    ema_period: 9             # For compatibility

    # Confirmation filters - ALL ENABLED for 1m noise
    use_rsi_filter: true
    rsi_period: 14            # 14-min RSI
    rsi_overbought: 70        # Standard levels
    rsi_oversold: 30

    use_adx_filter: true
    adx_period: 14
    min_adx: 15               # Lower threshold - any trend ok
    strong_adx: 25            # 25+ = strong trend

    use_volume_filter: true
    volume_window: 20
    volume_mult: 1.3          # Require 1.3x volume

    use_trend_filter: true    # Must align with higher TF trend

    # ATR-based volatility
    atr_period: 14
    atr_threshold: 0.005      # 0.5% 1m ATR for override (was 1.8% daily)

    # Risk management
    max_leverage: 3           # Was 5 - reduce for 1m trading
    max_positions: 2          # Max 2 concurrent positions

    # Tighter SL/TP for 1m
    stop_loss_pct: 0.004      # 0.4% stop
    take_profit_pct: 0.008    # 0.8% target (2:1 R:R)

    # Position sizing
    base_size_pct: 0.05       # 5% base position
    min_size_pct: 0.02        # Min 2%
    max_size_pct: 0.10        # Max 10%

    # Cooldown
    cooldown_bars: 3          # 3 bars = 3 min cooldown
    cooldown_minutes: 3       # 3 min minimum

  # ===== GRID STRATEGIES =====
  # All grid strategies now dynamically center on current price
  # range_pct: percentage above/below current price for grid range
  # recenter_threshold: recenter grid when price moves this % outside range

  grid_arithmetic:
    enabled: true
    category: grid
    description: "Fixed spacing grid - consistent fills"
    num_grids: 20
    range_pct: 0.04           # ±4% around current price
    recenter_threshold: 0.02  # Recenter when 2% outside range
    leverage: 1

  grid_geometric:
    enabled: true
    category: grid
    description: "Phase 26 Enhanced: ATR-dynamic geometric grid with extreme position bias"

    # Grid structure
    num_grids: 20             # More grids for geometric spacing
    leverage: 1               # Spot only for safety

    # Phase 26: Grid ratio (2% default - better for crypto volatility)
    grid_ratio: 1.02          # 2% between levels (was 0.8% - too tight!)

    # Phase 26: Dynamic range (calculated from live price)
    range_pct: 0.06           # ±6% around current price (wider for geometric)
    recenter_threshold: 0.04  # Recenter when 4% outside range
    recenter_after_cycles: 8  # Or after 8 completed cycles
    min_recenter_interval: 3600  # Min 1 hour between recenters

    # Phase 26: ATR-based dynamic grid ratio
    use_atr_ratio: true       # Enable ATR-based ratio adjustment
    atr_ratio_mult: 0.4       # ratio = 1 + (ATR% * 0.4)
    min_grid_ratio: 1.005     # Min 0.5% spacing (not too tight)
    max_grid_ratio: 1.05      # Max 5% spacing (not too wide)
    atr_period: 14

    # Phase 26: Position sizing at extremes (mean reversion bias)
    size_multiplier: 1.3      # 30% larger at extremes (was 15%)
    extreme_multiplier: 1.5   # Extra 50% boost at true extremes (top/bottom 20%)

    # Phase 26: Compound position sizing
    compound_profits: true
    max_compound: 1.5         # Max 150% of initial capital
    profit_distribution:
      reinvest: 0.7           # 70% reinvested (aggressive for geometric)
      realized: 0.3           # 30% taken as profit

    # Phase 26: Multi-asset support
    secondary_symbol: "XRP/USDT"
    secondary_allocation: 0.25  # 25% to XRP grid

    # Phase 26: Slippage and profit thresholds
    slippage_tolerance: 0.003   # 0.3% tolerance (higher for geometric)
    min_profit_per_cycle: 0.002 # 0.2% minimum profit per cycle

    # Risk management
    max_drawdown: 0.10          # 10% max drawdown
    fee_rate: 0.001             # 0.1% fee

  grid_rsi_reversion:
    enabled: true
    category: grid
    description: "Phase 26 RSI-enhanced mean reversion grid"

    # Grid structure
    num_grids: 12              # Fewer but wider levels for RSI reversion
    leverage: 2

    # Phase 26: Dynamic range (wider for mean reversion)
    range_pct: 0.05            # 5% above/below current price
    recenter_threshold: 0.03   # Recenter when 3% outside range
    recenter_after_cycles: 4   # Recenter after 4 completed cycles
    min_recenter_interval: 3600  # Min 1 hour between recenters

    # RSI parameters (relaxed for more signals)
    rsi_period: 14
    rsi_oversold: 30           # Relaxed from 25
    rsi_overbought: 70         # Relaxed from 75

    # Phase 26: RSI behavior mode
    # 'confidence_only' = RSI modifies confidence, doesn't block trades (recommended)
    # 'filter' = RSI must be in zone to trade (legacy behavior)
    rsi_mode: confidence_only

    # Phase 26: Adaptive RSI zones (widen in volatile markets)
    use_adaptive_rsi: true
    rsi_zone_expansion: 5      # Expand zones by ATR%

    # Phase 26: Position sizing at RSI extremes
    rsi_extreme_multiplier: 1.3  # 30% larger positions at RSI extremes

    # Phase 26: ATR-based dynamic spacing
    use_atr_spacing: true
    atr_multiplier: 0.4        # Each grid = 0.4 * ATR
    atr_period: 14

    # Phase 26: Compound position sizing
    compound_profits: true
    max_compound: 1.4          # Max 140% of initial capital
    profit_distribution:
      reinvest: 0.6            # 60% reinvested
      realized: 0.4            # 40% taken as profit

    # Phase 26: Slippage handling
    slippage_tolerance: 0.003   # 0.3% tolerance
    min_profit_per_cycle: 0.001 # 0.1% minimum profit

    # Risk management
    max_drawdown: 0.08          # 8% max drawdown
    fee_rate: 0.001             # 0.1% fee

  grid_bb_squeeze:
    enabled: true
    category: grid
    description: "TTM Squeeze Enhanced Grid - Keltner Channel + Momentum confirmation"

    # Grid parameters
    num_grids: 10
    range_pct: 0.03              # 3% above/below for tighter squeeze trades
    recenter_threshold: 0.025
    leverage: 2

    # Bollinger Band parameters
    bb_period: 20
    bb_std: 2.0

    # Keltner Channel parameters (TTM Squeeze Pro style)
    kc_period: 20
    kc_atr_mult_high: 1.0       # Tightest squeeze (most significant)
    kc_atr_mult_mid: 1.5        # Standard squeeze
    kc_atr_mult_low: 2.0        # Loose squeeze

    # Momentum parameters
    momentum_period: 12          # TTM default

    # Squeeze detection
    squeeze_min_bars: 6          # Minimum bars in squeeze before trading
    squeeze_confirmation: true   # Require momentum to confirm direction

    # Breakout parameters
    breakout_size_pct: 0.15      # 15% of capital for breakout trades
    breakout_leverage_mult: 2.0  # Multiply base leverage on breakout
    max_breakout_leverage: 5     # Cap breakout leverage

    # ATR-based risk management
    stop_loss_atr_mult: 1.5      # Stop at 1.5x ATR
    take_profit_atr_mult: 3.0    # TP at 3x ATR (2:1 R/R)

    # Position sizing
    use_atr_spacing: true        # Use ATR for dynamic grid spacing
    atr_period: 14
    atr_multiplier: 0.3

    # Risk limits
    max_drawdown: 0.08           # 8% max drawdown
    fee_rate: 0.001              # 0.1% fee

  # ===== MARGIN STRATEGIES =====

  grid_trend_margin:
    enabled: true
    category: margin
    description: "Phase 27: Dynamic trend-following margin grid with ATR-based risk"

    # ===== Dynamic Trendline (NEW) =====
    use_dynamic_trendline: true      # Calculate from swing lows
    trendline_lookback: 72           # Hours to look back for swing lows
    trendline_recalc_interval: 4     # Hours between recalculations
    min_swing_points: 3              # Min swing lows for valid trendline

    # ===== Grid Entry Levels (NEW) =====
    num_grid_levels: 5               # Entry price levels along trendline
    grid_spacing_pct: 0.015          # 1.5% between levels
    max_positions: 3                 # Max concurrent positions

    # ===== Entry Conditions (RELAXED) =====
    entry_tolerance: 0.01            # 1% (was 0.3%)
    rsi_threshold: 40                # Relaxed from 35
    rsi_oversold: 35
    rsi_overbought: 65
    entry_mode: or                   # 'or' = RSI OR trendline (relaxed)

    # ===== ATR-Based Risk Management (NEW) =====
    use_atr_stops: true              # Dynamic stops based on volatility
    atr_period: 14
    stop_loss_atr_mult: 2.0          # 2x ATR stop loss
    take_profit_atr_mult: 3.0        # 3x ATR take profit

    # ===== Fallback Fixed Percentages =====
    stop_loss_pct: 0.02              # 2% (was 0.5%)
    take_profit_1: 0.025             # 2.5% first target
    take_profit_2: 0.04              # 4% second target
    trailing_stop_pct: 0.012         # 1.2%

    # ===== Dynamic Leverage (NEW) =====
    use_dynamic_leverage: true       # Adjust leverage based on volatility
    leverage: 3                      # Base leverage (reduced from 5)
    max_leverage: 5
    min_leverage: 1
    high_vol_threshold: 0.03         # 3% ATR = reduce leverage
    low_vol_threshold: 0.015         # 1.5% ATR = increase leverage

    # ===== Direction Control =====
    allow_shorts: true               # Enable short positions in downtrends

    # ===== Position Sizing =====
    size_pct: 0.08                   # 8% per trade (was 10%)

    # ===== Grid Range =====
    range_pct: 0.06                  # 6% range
    recenter_threshold: 0.04
    recenter_after_cycles: 10        # Let trends run longer

  grid_dual_hedge:
    enabled: true
    category: margin
    description: "Dual grid with hedge protection"
    num_grids: 18
    hedge_leverage: 2
    range_pct: 0.05
    recenter_threshold: 0.03

  grid_time_weighted:
    enabled: true
    category: grid
    description: "Phase 27: Time-weighted grid with session awareness and TWAP execution"
    num_grids: 15
    range_pct: 0.04
    recenter_threshold: 0.02

    # ATR-based dynamic adjustment
    use_atr_adjustment: true
    atr_period: 14
    target_atr_pct: 0.02          # 2% baseline volatility

    # TWAP execution settings
    use_twap: true
    twap_slice_interval: 300      # 5 minutes between slices
    twap_randomize_pct: 0.1       # ±10% timing randomization

    # Weekend/holiday handling
    reduce_weekend_size: true
    weekend_size_mult: 0.5        # 50% size on weekends

    # Compound profit settings
    compound_profits: true
    max_compound: 1.5             # Max 150% of initial capital

    # Risk management
    max_drawdown: 0.10            # 10% max drawdown

  grid_liq_hunter:
    enabled: true
    category: margin
    description: "Phase 29: Enhanced liquidation hunt scalper with ATR zones & pattern detection"

    # ===== Leverage Configuration =====
    leverage: 3                      # Base leverage
    use_dynamic_leverage: true       # Adjust based on volatility
    max_leverage: 5                  # Low volatility = higher leverage
    min_leverage: 2                  # High volatility = lower leverage
    high_vol_threshold: 0.03         # 3% ATR = reduce leverage
    low_vol_threshold: 0.015         # 1.5% ATR = increase leverage

    # ===== Position Sizing =====
    size_pct: 0.08                   # 8% per trade
    min_size_pct: 0.04               # Minimum 4%
    max_size_pct: 0.15               # Maximum 15%
    max_positions: 2                 # Max concurrent positions

    # ===== ATR-Based Liquidation Zone Detection =====
    use_atr_zones: true              # Use ATR for zone calculation
    liq_zone_atr_mult: 1.5           # 1.5x ATR from swing point
    liq_zone_pct: 0.02               # Fallback: 2% fixed if ATR unavailable
    atr_period: 14                   # ATR calculation period

    # ===== Swing Detection =====
    lookback_bars: 50                # Price history for swing detection
    swing_lookback: 5                # Bars to confirm swing high/low
    min_swing_size_atr: 0.5          # Minimum swing = 0.5x ATR

    # ===== Volume Confirmation =====
    use_volume_filter: true          # Require volume spike for entry
    volume_spike_mult: 1.5           # Volume > 1.5x average
    volume_window: 20                # Volume averaging window

    # ===== RSI Filter =====
    use_rsi_filter: true             # Require RSI confirmation
    rsi_period: 14                   # RSI calculation period
    rsi_oversold: 30                 # Long entry when RSI < 30
    rsi_overbought: 70               # Short entry when RSI > 70
    rsi_extreme_oversold: 20         # Extra confidence boost
    rsi_extreme_overbought: 80       # Extra confidence boost

    # ===== Reversal Pattern Settings =====
    min_wick_ratio: 2.0              # Wick >= 2x body for hammer
    engulfing_body_ratio: 1.1        # Engulfing body 10% larger
    require_pattern: true            # Must have reversal pattern to enter
    pattern_confidence_boost: 0.15   # Pattern adds 15% confidence

    # ===== ATR-Based Risk Management =====
    use_atr_stops: true              # Use ATR for stops
    stop_loss_atr_mult: 1.5          # Stop = 1.5x ATR
    take_profit_atr_mult: 2.5        # TP = 2.5x ATR
    stop_loss_pct: 0.015             # Fallback: 1.5%
    take_profit_pct: 0.03            # Fallback: 3%

    # ===== Trailing Stop =====
    use_trailing_stop: true          # Enable trailing stops
    trailing_activation_atr: 1.5     # Activate after 1.5x ATR profit
    trailing_distance_atr: 1.0       # Trail by 1x ATR

    # ===== Session Awareness =====
    use_session_adjustment: true     # Adjust zones by session
    session_multipliers:
      asia: 0.8                      # 00:00-08:00 UTC - tighter zones
      europe: 1.0                    # 08:00-14:00 UTC - standard
      us: 1.2                        # 14:00-21:00 UTC - wider zones
      overnight: 0.9                 # 21:00-00:00 UTC - slightly tighter

    # ===== Compound Profits =====
    compound_profits: true           # Reinvest profits
    max_compound: 1.5                # Max 150% of initial capital
    profit_reinvest_ratio: 0.6       # 60% reinvested, 40% realized

    # ===== Trade Cooldown =====
    cooldown_bars: 3                 # Min bars between trades

    # ===== Grid wrapper settings =====
    range_pct: 0.04                  # 4% range
    recenter_threshold: 0.02         # Recenter after 2% move
    recenter_after_cycles: 20        # Or after 20 cycles

  # ===== PHASE 30: RESEARCH-BASED STRATEGIES (2025) =====

  # --- TREND FOLLOWING ---

  supertrend:
    enabled: true
    category: trend
    description: "ATR-based SuperTrend - 11% avg profit per trade in backtests"

    # Primary SuperTrend
    atr_period: 10
    atr_multiplier: 3.0

    # Double confirmation (reduces false signals)
    use_double_supertrend: true
    atr_period_slow: 25
    atr_multiplier_slow: 5.0

    # EMA filter for macro trend
    use_ema_filter: true
    ema_period: 200

    # Position sizing
    base_size_pct: 0.10
    dynamic_sizing: true
    min_size_pct: 0.05
    max_size_pct: 0.20

    # Risk management
    stop_loss_atr_mult: 1.5
    take_profit_atr_mult: 3.0
    max_leverage: 5

    # Cooldown
    cooldown_bars: 2

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  ichimoku_cloud:
    enabled: true
    category: trend
    description: "All-in-one Ichimoku system - BTC broke cloud at $93K, rallied to $120K+"

    # Trading style: 'scalping', 'default', 'swing'
    style: default
    displacement: 26

    # Signal settings
    require_chikou_confirm: true
    require_price_above_cloud: true
    use_tk_cross: true
    use_kumo_breakout: true

    # Risk
    use_kijun_stop: true
    base_size_pct: 0.12
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- ARBITRAGE ---

  funding_rate_arb:
    enabled: true
    category: arbitrage
    description: "Funding rate cash-and-carry - 19.26% APY avg in 2025"

    # Funding rate thresholds
    min_funding_rate: 0.01
    max_funding_rate: 0.10
    negative_funding_threshold: -0.01

    # Position parameters
    base_size_pct: 0.20
    max_positions: 3
    leverage: 2

    # Timing
    funding_interval_hours: 8
    entry_before_funding_minutes: 30
    exit_after_funding_minutes: 15

    # Costs
    trading_fee_pct: 0.001
    slippage_pct: 0.001

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"
      - "ETH/USDT"

  triangular_arb:
    enabled: false  # Requires high-frequency execution
    category: arbitrage
    description: "Triangular arbitrage on single exchange - 3-5% annualized"

    # Profit thresholds
    min_profit_pct: 0.10
    fee_per_trade: 0.001
    slippage_buffer: 0.001

    # Position sizing
    trade_size_pct: 0.05
    max_trade_size_usd: 500

    # Rate limiting
    cooldown_seconds: 10
    max_opportunities_per_hour: 20

    trios:
      - path: ['BTC', 'XRP', 'USDT']
        pairs: ['XRP/BTC', 'XRP/USDT', 'BTC/USDT']
      - path: ['BTC', 'ETH', 'USDT']
        pairs: ['ETH/BTC', 'ETH/USDT', 'BTC/USDT']

  # --- BREAKOUT ---

  volatility_breakout:
    enabled: true
    category: breakout
    description: "Donchian + Keltner dual channel breakout with ATR confirmation"

    # Donchian Channel
    donchian_period: 20
    donchian_exit_period: 10

    # Keltner Channel
    keltner_period: 20
    keltner_atr_mult: 2.0

    # ATR
    atr_period: 14
    atr_breakout_mult: 0.5
    atr_stop_mult: 1.5

    # Dual confirmation
    require_dual_confirmation: true

    # Volatility regime adjustments
    adjust_for_volatility: true
    low_vol_threshold: 1.0
    high_vol_threshold: 3.0

    # Position sizing
    base_size_pct: 0.10
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- CONFLUENCE ---

  multi_indicator_confluence:
    enabled: true
    category: confluence
    description: "RSI + MACD + EMA + BB + Volume - 77% win rate with proper confluence"

    # EMA Trend Filter
    ema_fast: 50
    ema_slow: 200

    # RSI
    rsi_period: 14
    rsi_bullish_threshold: 50
    rsi_oversold: 30
    rsi_overbought: 70

    # MACD
    macd_fast: 12
    macd_slow: 26
    macd_signal: 9

    # Bollinger Bands
    bb_period: 20
    bb_std: 2.0

    # Volume
    volume_mult: 1.5
    volume_window: 20

    # Confluence requirements
    min_confirmations: 3
    require_trend_alignment: true
    require_volume_confirm: true

    # Position sizing
    base_size_pct: 0.12
    confidence_scaling: true
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- SENTIMENT ---

  whale_sentiment:
    enabled: true
    category: sentiment
    description: "Whale tracking + sentiment analysis - contrarian opportunities"

    # Volume spike detection (whale proxy)
    volume_spike_mult: 2.0
    volume_window: 24

    # Fear/Greed proxy
    fear_deviation: -0.05
    greed_deviation: 0.05

    # RSI as sentiment
    rsi_period: 14
    rsi_fear: 25
    rsi_greed: 75

    # Contrarian mode (buy fear, sell greed)
    contrarian_mode: true

    # Sentiment thresholds
    bullish_threshold: 0.60
    bearish_threshold: 0.40

    base_size_pct: 0.10
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- ACCUMULATION ---

  enhanced_dca:
    enabled: true
    category: accumulation
    description: "Dynamic DCA with volatility-adjusted multipliers"

    # DCA base
    base_amount_usd: 50
    dca_interval_hours: 24

    # Moving average for fair value
    ma_period: 200
    short_ma_period: 50

    # Deviation multipliers (buy more when cheap)
    multipliers:
      -0.30: 3.0
      -0.20: 2.0
      -0.10: 1.5
      0.00: 1.0
      0.10: 0.75
      0.20: 0.50
      0.30: 0.25

    # RSI bonus
    rsi_period: 14
    rsi_extreme_oversold: 25
    rsi_extreme_bonus: 0.5

    # Asset allocation
    allocations:
      'BTC/USDT': 0.60
      'XRP/USDT': 0.40

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  twap_accumulator:
    enabled: false
    category: accumulation
    description: "TWAP execution for large orders - minimize market impact"

    # TWAP parameters
    total_amount_usd: 1000
    duration_hours: 24
    interval_minutes: 30

    # Randomization
    use_jitter: true
    jitter_pct: 0.20

    # Volume weighting
    use_volume_weight: true
    volume_window: 24

    allocations:
      'BTC/USDT': 0.60
      'XRP/USDT': 0.40

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- VOLUME ---

  volume_profile:
    enabled: true
    category: volume
    description: "POC and Value Area trading - identify key S/R levels"

    # Volume Profile
    lookback_bars: 100
    num_bins: 50
    value_area_pct: 0.70

    # Trading
    poc_tolerance: 0.005
    va_tolerance: 0.01

    # Momentum filter
    use_momentum_filter: true
    momentum_period: 14

    base_size_pct: 0.10
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- MOMENTUM ---

  wavetrend:
    enabled: true
    category: momentum
    description: "WaveTrend oscillator - cleaner signals than RSI for crypto"

    # WaveTrend parameters
    channel_length: 10
    average_length: 21
    ma_length: 4

    # Thresholds
    overbought: 60
    oversold: -60
    extreme_overbought: 80
    extreme_oversold: -80

    # Signals
    require_zone_exit: true
    use_divergence: true
    divergence_lookback: 14

    base_size_pct: 0.10
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

  # --- SCALPER (1m/5m) ---

  scalping_1m5m:
    enabled: true
    category: scalper
    description: "1m/5m scalping - SMA cross + CHOCH + prev day levels"

    # Timeframe
    primary_timeframe: "5m"

    # SMA Crossover
    sma_fast: 5
    sma_slow: 12

    # EMA filter
    ema_period: 200
    use_ema_filter: true

    # Previous day levels
    use_prev_day_levels: true
    level_tolerance: 0.002

    # CHOCH detection
    use_choch: true
    choch_lookback: 10

    # Risk
    scalp_target_pct: 0.005
    scalp_stop_pct: 0.003
    max_positions: 2

    base_size_pct: 0.05
    cooldown_seconds: 60
    max_leverage: 5

    symbols:
      - "BTC/USDT"
      - "XRP/USDT"

# Experiment presets - quick parameter sets for A/B testing
experiments:
  aggressive:
    description: "Higher leverage, tighter thresholds"
    overrides:
      mean_reversion_vwap:
        max_leverage: 7
        rsi_oversold: 32
        rsi_overbought: 68
      xrp_btc_pair_trading:
        entry_z: 1.5
        max_leverage: 7
        coint_pvalue_threshold: 0.10  # Relax cointegration slightly
        min_expected_profit: 0.005    # Lower profit threshold

  conservative:
    description: "Lower leverage, wider thresholds"
    overrides:
      mean_reversion_vwap:
        max_leverage: 3
        rsi_oversold: 38
        rsi_overbought: 62
      xrp_btc_pair_trading:
        entry_z: 2.5
        max_leverage: 3
        coint_pvalue_threshold: 0.03  # Stricter cointegration
        min_expected_profit: 0.015    # Higher profit threshold

  pair_trading_relaxed:
    description: "Relaxed pair trading for when cointegration is borderline"
    enable_only:
      - xrp_btc_pair_trading
    overrides:
      xrp_btc_pair_trading:
        require_cointegration: false
        use_half_life_filter: false
        entry_z: 1.8
        coint_pvalue_threshold: 0.15

  grid_focus:
    description: "Enable grid strategies only"
    enable_only:
      - grid_arithmetic
      - grid_geometric
      - grid_rsi_reversion
      - grid_bb_squeeze

  geometric_grid_aggressive:
    description: "Aggressive geometric grid with higher leverage and tighter recentering"
    enable_only:
      - grid_geometric
    overrides:
      grid_geometric:
        leverage: 2              # 2x leverage
        grid_ratio: 1.015        # Tighter 1.5% spacing
        range_pct: 0.05          # Narrower range
        recenter_after_cycles: 5 # Faster recentering
        size_multiplier: 1.4     # More aggressive at extremes
        extreme_multiplier: 1.8  # Very aggressive at true extremes
        secondary_allocation: 0.35  # More XRP

  geometric_grid_conservative:
    description: "Conservative geometric grid for sideways markets"
    enable_only:
      - grid_geometric
    overrides:
      grid_geometric:
        leverage: 1              # Spot only
        grid_ratio: 1.025        # Wider 2.5% spacing
        range_pct: 0.08          # Wider range
        recenter_after_cycles: 12  # Less frequent recentering
        size_multiplier: 1.2     # Less aggressive at extremes
        max_compound: 1.3        # Cap compound growth
        secondary_allocation: 0.15  # Less XRP

  lstm_focus:
    description: "Enable LSTM-based strategies only"
    enable_only:
      - xrp_momentum_lstm
      - dip_detector

  dip_hunting:
    description: "Aggressive dip buying settings with enhanced divergence detection"
    overrides:
      dip_detector:
        rsi_oversold: 42              # More aggressive - buy earlier dips
        rsi_extreme_oversold: 30      # Relaxed extreme threshold
        drawdown_threshold: -0.03     # 3% dip is enough
        volume_surge_threshold: 1.3   # Lower volume requirement
        use_btc_filter: true          # Keep BTC filter for safety
        btc_stable_threshold: 0.03    # Tolerate larger BTC moves
        use_divergence: true          # Enable divergence detection
        cooldown_minutes: 15          # Faster re-entry
        stop_loss_pct: 0.02           # Tighter stops for dip plays
        take_profit_pct: 0.04         # Smaller targets, faster exits
      xrp_momentum_lstm:
        dip_threshold: -0.015         # More aggressive dip detection
        volume_spike_mult: 1.3        # Lower volume requirement
        momentum_recovery_threshold: -0.02
        use_btc_correlation: true     # Use BTC as leading indicator
        stop_loss_pct: 0.02           # Tighter stops for dip plays
        take_profit_pct: 0.03         # Smaller targets, faster exits

  xrp_lstm_aggressive:
    description: "Aggressive XRP LSTM settings with trailing stops"
    enable_only:
      - xrp_momentum_lstm
    overrides:
      xrp_momentum_lstm:
        dip_threshold: -0.015
        volume_spike_mult: 1.3
        momentum_buy_threshold: 0.02
        momentum_sell_threshold: -0.02
        trailing_stop: true
        trailing_stop_pct: 0.015
        max_leverage: 10

  xrp_lstm_conservative:
    description: "Conservative XRP LSTM with strict filters"
    enable_only:
      - xrp_momentum_lstm
    overrides:
      xrp_momentum_lstm:
        dip_threshold: -0.03
        volume_spike_mult: 2.0
        momentum_buy_threshold: 0.04
        momentum_sell_threshold: -0.04
        mtf_agreement_required: true   # Require 5m alignment
        max_leverage: 5
        stop_loss_pct: 0.04
        take_profit_pct: 0.08

  full_ensemble:
    description: "Enable all non-grid strategies"
    enable_only:
      - mean_reversion_vwap
      - xrp_btc_pair_trading
      - ma_trend_follow
      - xrp_btc_leadlag
      - mean_reversion_short
      - xrp_momentum_lstm
      - dip_detector
      - intraday_scalper

  ma_trend_aggressive:
    description: "MA trend follow with relaxed filters for more signals"
    enable_only:
      - ma_trend_follow
    overrides:
      ma_trend_follow:
        min_adx: 15                 # Lower ADX threshold
        confirmation_candles: 1     # Faster entries
        min_distance_pct: 0.002     # Closer to MA allowed
        cooldown_hours: 2           # Shorter cooldown
        atr_stop_mult: 2.5          # Wider stops

  ma_trend_conservative:
    description: "MA trend follow with strict filters for quality signals"
    enable_only:
      - ma_trend_follow
    overrides:
      ma_trend_follow:
        min_adx: 25                 # Higher ADX required
        strong_adx: 35              # Higher strong threshold
        confirmation_candles: 3     # More confirmations
        min_distance_pct: 0.005     # Further from MA required
        cooldown_hours: 6           # Longer cooldown
        atr_stop_mult: 1.5          # Tighter stops
        volume_mult: 1.5            # Higher volume required

  # ===== PHASE 30 EXPERIMENT PRESETS =====

  phase30_full:
    description: "All Phase 30 research-based strategies"
    enable_only:
      - supertrend
      - ichimoku_cloud
      - funding_rate_arb
      - volatility_breakout
      - multi_indicator_confluence
      - whale_sentiment
      - enhanced_dca
      - volume_profile
      - wavetrend
      - scalping_1m5m

  phase30_trend:
    description: "Phase 30 trend-following strategies only"
    enable_only:
      - supertrend
      - ichimoku_cloud
      - volatility_breakout

  phase30_momentum:
    description: "Phase 30 momentum and confluence strategies"
    enable_only:
      - wavetrend
      - multi_indicator_confluence
      - whale_sentiment

  phase30_accumulation:
    description: "Phase 30 accumulation/DCA strategies"
    enable_only:
      - enhanced_dca
      - volume_profile

  phase30_scalping:
    description: "All scalping strategies (existing + Phase 30)"
    enable_only:
      - intraday_scalper
      - ema9_scalper
      - scalping_1m5m
